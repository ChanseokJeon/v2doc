# Test Fixtures

This directory contains comprehensive test fixtures for the yt2pdf project.

## Structure

```
tests/
├── fixtures/
│   ├── video-metadata.ts   # Sample video metadata (various types and durations)
│   ├── subtitles.ts        # Sample subtitle data (English, Korean, mixed)
│   ├── chapters.ts         # Sample chapter structures (various lengths)
│   └── index.ts            # Central export for all fixtures
└── helpers/
    └── mock-factory.ts     # Factory functions to create test data
```

## Usage

### Import Fixtures

```typescript
import {
  shortVideoMetadata,
  mediumVideoMetadata,
  koreanSubtitles,
  tutorialChapters,
} from '../fixtures';
```

### Use Mock Factory

```typescript
import { createMockVideoMetadata, createMockSubtitles } from '../fixtures';

// Create custom test data
const metadata = createMockVideoMetadata({
  duration: 1800,
  title: 'Custom Test Video',
});

const subtitles = createMockSubtitles(10, 30); // 10 segments, 30 seconds each
```

## Available Fixtures

### Video Metadata (`video-metadata.ts`)

- `shortVideoMetadata` - Short video (< 5 min)
- `mediumVideoMetadata` - Medium video with chapters (10-30 min)
- `longVideoMetadata` - Long video with Korean captions (> 1 hour)
- `koreanVideoMetadata` - Korean video with multiple caption sources
- `noChaptersVideoMetadata` - Video without chapters
- `noCaptionsVideoMetadata` - Video without captions (Whisper fallback test)
- `interviewVideoMetadata` - Interview-style video
- `conferenceVideoMetadata` - Conference talk with high view count

**Helpers:**
- `getMetadataByType(type)` - Filter by video type
- `getMetadataByDuration(min, max)` - Filter by duration range

### Subtitles (`subtitles.ts`)

- `shortEnglishSubtitles` - Short English subtitles
- `koreanSubtitles` - Korean subtitles
- `mixedLanguageSubtitles` - Korean with English technical terms
- `longConferenceSubtitles` - Conference talk subtitles
- `subtitlesWithDuplicates` - For deduplication testing
- `subtitlesWithSpecialChars` - Special characters and formatting
- `rapidSubtitles` - Rapid speech (short intervals)
- `emptySubtitles` - Edge case testing

**SubtitleResult:**
- `koreanYouTubeResult` - Korean YouTube captions
- `englishYouTubeResult` - English YouTube captions
- `whisperResult` - Whisper API result

**Helpers:**
- `generateSubtitles(duration, interval, language)` - Generate custom subtitles
- `getFullText(segments)` - Concatenate all subtitle text
- `getSubtitlesInRange(segments, start, end)` - Filter by time range

### Chapters (`chapters.ts`)

- `noChapters` / `emptyChapters` - No chapter data
- `shortVideoChapters` - Short video chapters (3-5 min)
- `tutorialChapters` - Tutorial-style (15-20 min)
- `conferenceTalkChapters` - Conference talk (30-45 min)
- `lectureChapters` - Detailed lecture (60-90 min)
- `koreanChapters` - Korean chapter titles
- `interviewChapters` - Interview structure
- `rapidChapters` - Very short segments
- `longChapters` - Long deep-dive segments
- `autoGeneratedChapters` - Auto-generated (no YouTube chapters)
- `chaptersWithSpecialChars` - Special characters in titles
- `singleChapter` - Single chapter for entire video

**Helpers:**
- `generateChapters(duration, interval, language)` - Generate custom chapters
- `getChapterAtTime(chapters, timestamp)` - Find chapter at timestamp
- `getChapterDuration(chapter)` - Calculate chapter duration
- `validateChapters(chapters)` - Validate structure (no gaps/overlaps)

## Mock Factory (`helpers/mock-factory.ts`)

### Basic Mocks

- `createMockVideoMetadata(overrides?)` - Create video metadata
- `createMockSubtitles(count?, interval?)` - Create subtitle array
- `createMockChapters(count?, interval?)` - Create chapter array
- `createMockScreenshot(overrides?)` - Create screenshot
- `createMockScreenshots(count?, interval?)` - Create screenshot array

### Advanced Mocks

- `createMockPDFSection(overrides?)` - Create PDF section
- `createMockPDFSections(count)` - Create multiple sections
- `createMockContentSummary(overrides?)` - Create summary
- `createMockCoverMetadata(overrides?)` - Create cover page metadata
- `createMockPDFContent(overrides?)` - Create complete PDF content
- `createMockExecutiveBrief(overrides?)` - Create executive brief

### Specialized Factories

- `createMockVideoByType(type, duration?)` - Create video by type
- `createMockE2EDataset()` - Complete dataset for E2E tests
- `createKoreanMockData()` - Korean test data
- `createMinimalMockData()` - Minimal data (performance tests)
- `createLargeMockData(sectionCount?)` - Large data (stress tests)

## Examples

### Unit Test Example

```typescript
import { describe, it, expect } from 'vitest';
import { shortVideoMetadata, createMockSubtitles } from '../fixtures';
import { formatTimestamp } from '../../src/utils';

describe('Timestamp Formatting', () => {
  it('should format video duration', () => {
    const duration = shortVideoMetadata.duration;
    expect(formatTimestamp(duration)).toBe('3:00');
  });
});
```

### Integration Test Example

```typescript
import { describe, it, expect } from 'vitest';
import { createMockPDFContent } from '../fixtures';
import { PDFGenerator } from '../../src/core/pdf-generator';

describe('PDF Generator', () => {
  it('should generate PDF from mock content', async () => {
    const content = createMockPDFContent();
    const generator = new PDFGenerator();
    const result = await generator.generate(content);
    expect(result).toBeDefined();
  });
});
```

### E2E Test Example

```typescript
import { describe, it, expect } from 'vitest';
import { createMockE2EDataset } from '../fixtures';
import { pipeline } from '../../src/pipeline';

describe('Full Pipeline', () => {
  it('should process complete dataset', async () => {
    const dataset = createMockE2EDataset();
    const result = await pipeline.process(dataset);
    expect(result.success).toBe(true);
  });
});
```

## Best Practices

1. **Use existing fixtures** when possible - they cover common scenarios
2. **Use mock factory** for custom test cases - flexible and type-safe
3. **Create specialized fixtures** for repeated patterns in your tests
4. **Keep fixtures realistic** - match real YouTube data structure
5. **Document edge cases** - explain why specific fixtures exist

## Adding New Fixtures

When adding new fixtures:

1. Add to the appropriate file (`video-metadata.ts`, `subtitles.ts`, `chapters.ts`)
2. Export from `fixtures/index.ts`
3. Update this README with usage examples
4. Ensure TypeScript types match actual codebase types
5. Run `npm run build` to verify no type errors
